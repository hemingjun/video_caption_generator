# 视频字幕生成器 PRD

## 1. 项目概述

### 项目规模：中型
- 预计代码量：1500-2000行
- 开发周期：2-3周
- 模块数量：5-6个核心模块

### 核心价值
- **自动化**：一键将视频中的语音转换为多语言字幕
- **高质量**：使用OpenAI的Whisper和GPT模型，确保识别和翻译准确性
- **灵活输出**：支持SRT字幕文件和纯文本两种格式
- **批处理**：支持多文件批量处理，提高效率

### 技术可行性
- ✅ 音频提取：FFmpeg成熟方案
- ✅ 语音识别：Whisper模型本地运行，无需网络
- ✅ AI翻译：OpenAI API稳定可靠
- ✅ 字幕生成：标准SRT格式，广泛兼容

## 2. 功能需求

### P0 - 核心必须功能
1. **视频音频提取**
   - 支持常见视频格式（MP4, AVI, MOV, MKV）
   - 自动转换为WAV格式供Whisper处理

2. **语音转文字**
   - 使用Whisper模型进行语音识别
   - 支持多语言音频识别
   - 生成带时间戳的转录结果

3. **AI翻译**
   - 集成OpenAI API进行翻译
   - 默认翻译为简体中文
   - 保持原文语义和语气

4. **结果输出**
   - SRT字幕文件（带时间轴）
   - 纯文本文件（仅文字内容）

### P1 - 重要功能
1. **批量处理**
   - 支持文件夹批量处理
   - 进度显示和预计剩余时间

2. **语言配置**
   - 支持指定源语言
   - 支持多目标语言翻译

3. **质量控制**
   - 翻译结果人工校对接口
   - 保存原文和译文对照

### P2 - 可选功能
1. **高级配置**
   - Whisper模型大小选择
   - 翻译风格设置（正式/口语）

2. **输出定制**
   - 字幕样式设置
   - 分段规则配置

## 3. 技术架构

### 模块划分
```
video_caption_generator/
├── src/
│   ├── extractor/      # 音频提取模块 (~150行)
│   │   └── ffmpeg_extractor.py
│   ├── transcriber/    # 语音识别模块 (~180行)
│   │   └── whisper_transcriber.py
│   ├── translator/     # 翻译模块 (~160行)
│   │   └── openai_translator.py
│   ├── formatter/      # 输出格式化模块 (~140行)
│   │   ├── srt_formatter.py
│   │   └── text_formatter.py
│   ├── config/         # 配置管理 (~100行)
│   │   └── settings.py
│   └── utils/          # 工具函数 (~120行)
│       └── helpers.py
├── cli.py              # CLI入口 (~150行)
├── requirements.txt
└── config.yaml         # 用户配置文件
```

### 数据流向图
```
视频文件 → [音频提取] → WAV音频
    ↓
[Whisper识别] → 带时间戳的原文
    ↓
[OpenAI翻译] → 翻译后文本
    ↓
[格式化输出] → SRT字幕/文本文件
```

### 核心依赖
- `openai-whisper`: 语音识别
- `openai`: API调用
- `ffmpeg-python`: 音频提取
- `pydantic`: 配置验证
- `click`: CLI框架
- `tqdm`: 进度显示

## 4. 开发约束

### 上下文限制考虑
- 单次处理视频长度建议 < 30分钟
- 长视频自动分段处理（5分钟一段）
- 翻译时按句子批量发送，避免token超限

### 文件数量控制
- 核心代码文件：8-10个
- 每个模块独立，便于测试和维护
- 配置文件集中管理

### 代码复杂度限制
- 函数行数 < 30行
- 函数参数 < 3个
- 嵌套层级 < 3层
- 使用类型注解提高可读性

### 错误处理
- 网络错误自动重试（3次）
- 详细的错误日志
- 用户友好的错误提示

## 5. API密钥管理
- OpenAI API密钥通过环境变量配置
- 支持配置文件覆盖
- 密钥不纳入版本控制

## 6. 性能指标
- 5分钟视频处理时间 < 2分钟
- 内存占用 < 2GB
- 支持并行处理提高效率

## 7. 输出示例

### SRT格式
```srt
1
00:00:00,000 --> 00:00:03,500
Hello, welcome to our presentation.
你好，欢迎来到我们的演示。

2
00:00:03,500 --> 00:00:07,000
Today we'll discuss artificial intelligence.
今天我们将讨论人工智能。
```

### 文本格式
```
[00:00:00] Hello, welcome to our presentation.
你好，欢迎来到我们的演示。

[00:00:03] Today we'll discuss artificial intelligence.
今天我们将讨论人工智能。
```